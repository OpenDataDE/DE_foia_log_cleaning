---
title: "Cleaning DOE FOIA Data"
author: "Ryan Harrington"
output: html_document
---

This notebook outlines the steps taken to clean the Department of Education's FOIA logs.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}

# For file management
# install.packages("here")
library(here)

# For data manipulation, functional programming, and graphing
# install.packages("tidyverse")
library(tidyverse)

# For reading in data from Excel
# install.packages("readxl")
library(readxl)

# install.packages("broom")
library(broom)

```

# Load Files

The DOE's FOIA logs were sent as multiple files. We must get a list of all of these files to open them sequentially.

```{r}

files <- list.files(here("Data/Department of Education"))

DOE_dfs <-
  data.frame(matrix(nrow = length(files),
                    ncol = 3)) %>% 
  rename("Names" = X1, "Year" = X2, "df" = X3) %>% 
  mutate(Names = as.character(Names),
         Year = as.numeric(Year))

df_list <- list(NULL)

i <- 0

for (file in files) {
  
  i <- i + 1
  
  file_year <- str_extract(string = file,
                           pattern = "[0-9]{4}")
  
  var_name <- paste("DOE_foia_log", file_year, sep = "_")
  
  temp_df <- read_excel(here("Data/Department of Education", file))
  
  assign(x = var_name, value = temp_df)
  
  DOE_dfs$Names[i] <- var_name
  DOE_dfs$Year[i] <- file_year
  
  df_list[[i]] <- temp_df
  
}

DOE_dfs$df <- df_list

```

```{r}

DOE_FOIA_logs <- map(files, ~read_excel(here("Data/Department of Education", .x), col_types = "text"))

map_df(map_test, function(x) if(is.data.frame(x)) x)

map_test[[6]]

map(DOE_FOIA_logs)


import_file <- function(path, file, var_name_stem, ...) {
  
  file_year <- str_extract(string = file,
                           pattern = "[0-9]{4}")
  
  var_name <- paste(var_name_stem, file_year, sep = "_")
  
  temp_df <- read_excel(here(path, file))
  
  assign(x = var_name, value = temp_df)
  
  DOE_dfs$Names[i] <- var_name
  DOE_dfs$Year[i] <- file_year
  
  df_list[[i]] <- temp_df
  
}

DOE_FOIA_logs <- map(files, ~import_file(path = "Data/Department of Education",
                                         file = .x,
                                         var_name_stem = "DOE_foia_log"))


check_columns <- function(df) {
  
  temp_colnames <- colnames(df)
  
  temp_classes <- list(NULL)
  
  for (j in 1:ncol(df)) {
    
    temp_classes[j] <- class(df[j])
    
  }
  
  col_classes <- data.frame(Name = as.character(DOE_dfs$Names[i]),
                            Year = as.numeric(DOE_dfs$Year[i]),
                            Column_Name = as.character(temp_colnames),
                            Class = as.character(temp_classes))
  
}

```


We also want to get a better understanding of what all of the columns are named in each file. In an ideal world, each file would consist of the same column names.

```{r}

DOE_dfs_columns <- data.frame(Name = as.character(NA),
                              Year = as.numeric(NA),
                              Column_Name = as.character(NA),
                              Class = as.character(NA))

for (i in 1:nrow(DOE_dfs)) {
  
  temp_colnames <- colnames(DOE_dfs$df[[i]])
  
  temp_classes <- list(NULL)
  
  for (j in 1:ncol(DOE_dfs$df[[i]])) {
    
    temp_classes[j] <- class(DOE_dfs$df[[i]][[j]])
    
  }
  
  temp_df <- data.frame(Name = as.character(DOE_dfs$Names[i]),
                        Year = as.numeric(DOE_dfs$Year[i]),
                        Column_Name = as.character(temp_colnames),
                        Class = as.character(temp_classes))
  
  DOE_dfs_columns <-
    DOE_dfs_columns %>% 
    union(temp_df)
  
}

```

# Compare Columns

We can see that 2014 follows a slightly different naming convention than the other files, which all follow the same naming convention. We will need to rename the columns in 2014 to match every other file. In particular, we need to rename:

* `Administrative fees` to `Admin fees`
* `Date received` to `Date Rec'd`
* `Requesting party & contact information` to `Requestor's Contact Information`
* `Response due date (15 biz days)` to `Response Due (15 biz days)`
* `Were all records included? If no, state why.` to `Were all records included? If no, why`

After renaming 2014, we will shorten the name of every field and make them consistent with naming conventions that we have used when cleaning FOIA logs from other agencies.

```{r}

DOE_dfs_columns %>% 
  filter(! is.na(Name)) %>% 
  select(-Name) %>% 
  spread(key = Year, value = Class)

```

# Rename Fields

First we can take care of renaming the fields in 2014. Now all field names should match across all files.

```{r}

DOE_foia_log_2014 <-
  DOE_foia_log_2014 %>% 
  rename("Admin fees" = `Administrative fees`,
         "Date Rec'd" = `Date received`,
         "Requestor's Contact Information" = `Requesting party & contact information`,
         "Response Due (15 biz days)" = `Response due date (15 biz days)`,
         "Were all records included? If no, why" = `Were all records included? If no, state why.`)



colnames(DOE_foia_log_2014)

```

```{r}

DOE_foia_log_2014 <-
  DOE_foia_log_2014 %>% 
  rename("Date_Received" = `Date Rec'd`,
         "Date_Response" = `Response Due (15 biz days)`,
         "Information_Requested" = `Requested records`,
         "Requesting_Party" = `Requestor's Contact Information`,
         "Is_Noncustodial_Record" = `Non-custodial records?`,
         "Date_Receipt_Non_Custodial" = `Date of receipt of non-custodial records`,
         "Date_Review" = `Date of agency's internal review`,
         "Internally_Reviewed_By" = `Internally reviewed by`,
         "Date_Agency_Response" = `Date of agency response`,
         "All_Requested_Records_Sent" = `Were all records included? If no, why`,
         "Date_Provided" = `Date provided`,
         "Copying_Fees" = `Copying fees`,
         "Administrative_Fees" = `Admin fees`,
         "Date_of_Final_Disposition" = `Date of final disposition`)

DOE_foia_log_2015 <-
  DOE_foia_log_2015 %>% 
  rename("Date_Received" = `Date Rec'd`,
         "Date_Response" = `Response Due (15 biz days)`,
         "Information_Requested" = `Requested records`,
         "Requesting_Party" = `Requestor's Contact Information`,
         "Is_Noncustodial_Record" = `Non-custodial records?`,
         "Date_Receipt_Non_Custodial" = `Date of receipt of non-custodial records`,
         "Date_Review" = `Date of agency's internal review`,
         "Internally_Reviewed_By" = `Internally reviewed by`,
         "Date_Agency_Response" = `Date of agency response`,
         "All_Requested_Records_Sent" = `Were all records included? If no, why`,
         "Date_Provided" = `Date provided`,
         "Copying_Fees" = `Copying fees`,
         "Administrative_Fees" = `Admin fees`,
         "Date_of_Final_Disposition" = `Date of final disposition`)

DOE_foia_log_2016 <-
  DOE_foia_log_2016 %>% 
  rename("Date_Received" = `Date Rec'd`,
         "Date_Response" = `Response Due (15 biz days)`,
         "Information_Requested" = `Requested records`,
         "Requesting_Party" = `Requestor's Contact Information`,
         "Is_Noncustodial_Record" = `Non-custodial records?`,
         "Date_Receipt_Non_Custodial" = `Date of receipt of non-custodial records`,
         "Date_Review" = `Date of agency's internal review`,
         "Internally_Reviewed_By" = `Internally reviewed by`,
         "Date_Agency_Response" = `Date of agency response`,
         "All_Requested_Records_Sent" = `Were all records included? If no, why`,
         "Date_Provided" = `Date provided`,
         "Copying_Fees" = `Copying fees`,
         "Administrative_Fees" = `Admin fees`,
         "Date_of_Final_Disposition" = `Date of final disposition`)

DOE_foia_log_2017 <-
  DOE_foia_log_2017 %>% 
  rename("Date_Received" = `Date Rec'd`,
         "Date_Response" = `Response Due (15 biz days)`,
         "Information_Requested" = `Requested records`,
         "Requesting_Party" = `Requestor's Contact Information`,
         "Is_Noncustodial_Record" = `Non-custodial records?`,
         "Date_Receipt_Non_Custodial" = `Date of receipt of non-custodial records`,
         "Date_Review" = `Date of agency's internal review`,
         "Internally_Reviewed_By" = `Internally reviewed by`,
         "Date_Agency_Response" = `Date of agency response`,
         "All_Requested_Records_Sent" = `Were all records included? If no, why`,
         "Date_Provided" = `Date provided`,
         "Copying_Fees" = `Copying fees`,
         "Administrative_Fees" = `Admin fees`,
         "Date_of_Final_Disposition" = `Date of final disposition`)

DOE_foia_log_2018 <-
  DOE_foia_log_2018 %>% 
  rename("Date_Received" = `Date Rec'd`,
         "Date_Response" = `Response Due (15 biz days)`,
         "Information_Requested" = `Requested records`,
         "Requesting_Party" = `Requestor's Contact Information`,
         "Is_Noncustodial_Record" = `Non-custodial records?`,
         "Date_Receipt_Non_Custodial" = `Date of receipt of non-custodial records`,
         "Date_Review" = `Date of agency's internal review`,
         "Internally_Reviewed_By" = `Internally reviewed by`,
         "Date_Agency_Response" = `Date of agency response`,
         "All_Requested_Records_Sent" = `Were all records included? If no, why`,
         "Date_Provided" = `Date provided`,
         "Copying_Fees" = `Copying fees`,
         "Administrative_Fees" = `Admin fees`,
         "Date_of_Final_Disposition" = `Date of final disposition`)

DOE_foia_log_2019 <-
  DOE_foia_log_2019 %>% 
  rename("Date_Received" = `Date Rec'd`,
         "Date_Response" = `Response Due (15 biz days)`,
         "Information_Requested" = `Requested records`,
         "Requesting_Party" = `Requestor's Contact Information`,
         "Is_Noncustodial_Record" = `Non-custodial records?`,
         "Date_Receipt_Non_Custodial" = `Date of receipt of non-custodial records`,
         "Date_Review" = `Date of agency's internal review`,
         "Internally_Reviewed_By" = `Internally reviewed by`,
         "Date_Agency_Response" = `Date of agency response`,
         "All_Requested_Records_Sent" = `Were all records included? If no, why`,
         "Date_Provided" = `Date provided`,
         "Copying_Fees" = `Copying fees`,
         "Administrative_Fees" = `Admin fees`,
         "Date_of_Final_Disposition" = `Date of final disposition`)

```

# Prep for Union

Also, we can see that the class of each field might be different year-to-year. There are a few instances of this:

* `Date of agency's internal review` is a `character` in 2014 and 2015, but is a `POSIXct` every other year
* `Date of final disposition` is a `character` every year except 2019, when it is a `POSIXct`
* `Date Rec'd` is a character in 2014 through 2016 (including the `Date received` column from 2014), but a `POSIXct` every other year
* `Response Due (15 biz days)` is a character in 2014 and 2015, but a `POSIXct` every other year

If you have ever had to clean data before, it is probably not surprising to you that each of the fields with an issue is a date field. We will need to convert the field for each year to always be the same class - so _always_ a `character` or always a `POSIXct` (though a `Date` class may be more appropriate).

## Date_Review

```{r}

DOE_foia_log_2014 <-
  DOE_foia_log_2014 %>% 
  mutate(Date_Review = if_else(str_detect(string = Date_Review,
                                          pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                               str_extract(string = Date_Review,
                                          pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                               Date_Review),
         Date_Review = case_when(str_detect(string = Date_Review,
                                            pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Review),
                                                                            origin = "1899-12-30"),
                                 str_detect(string = Date_Review,
                                            pattern = "[0-9]{2}/[0-9]{2}/[0-9]{4}") ~ as.Date(Date_Review,
                                                                                              format = "%m/%d/%Y")))

```

```{r}

DOE_foia_log_2015 <-
  DOE_foia_log_2015 %>% 
  mutate(Date_Review = if_else(str_detect(string = Date_Review,
                                          pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                               str_extract(string = Date_Review,
                                          pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                               Date_Review),
         Date_Review = case_when(str_detect(string = Date_Review,
                                            pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Review),
                                                                            origin = "1899-12-30"),
                                 str_detect(string = Date_Review,
                                            pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Review,
                                                                                              format = "%m/%d/%Y"),
                                 str_detect(string = Date_Review,
                                            pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Review,
                                                                                              format = "%m/%d/%y"),
                                 str_detect(string = Date_Review,
                                            pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Review,
                                                                                              format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2016 <-
  DOE_foia_log_2016 %>% 
  mutate(Date_Review = as.Date(Date_Review))

DOE_foia_log_2017 <-
  DOE_foia_log_2017 %>% 
  mutate(Date_Review = as.Date(Date_Review))

DOE_foia_log_2018 <-
  DOE_foia_log_2018 %>% 
  mutate(Date_Review = as.Date(Date_Review))

DOE_foia_log_2019 <-
  DOE_foia_log_2019 %>% 
  mutate(Date_Review = as.Date(Date_Review))

```

## Date_Received

```{r}

DOE_foia_log_2014 <-
  DOE_foia_log_2014 %>% 
  mutate(Date_Received = if_else(str_detect(string = Date_Received,
                                            pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 str_extract(string = Date_Received,
                                             pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 Date_Received),
         Date_Received = case_when(str_detect(string = Date_Received,
                                              pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Received),
                                                                              origin = "1899-12-30"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Received,
                                                                                                    format = "%m/%d/%Y"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Received,
                                                                                                    format = "%m/%d/%y"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Received,
                                                                                                        format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2015 <-
  DOE_foia_log_2015 %>% 
  mutate(Date_Received = if_else(str_detect(string = Date_Received,
                                            pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 str_extract(string = Date_Received,
                                             pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 Date_Received),
         Date_Received = case_when(str_detect(string = Date_Received,
                                              pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Received),
                                                                              origin = "1899-12-30"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Received,
                                                                                                    format = "%m/%d/%Y"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Received,
                                                                                                    format = "%m/%d/%y"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Received,
                                                                                                        format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2016 <-
  DOE_foia_log_2016 %>% 
  mutate(Date_Received = if_else(str_detect(string = Date_Received,
                                            pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 str_extract(string = Date_Received,
                                             pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 Date_Received),
         Date_Received = case_when(str_detect(string = Date_Received,
                                              pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Received),
                                                                              origin = "1899-12-30"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Received,
                                                                                                    format = "%m/%d/%Y"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Received,
                                                                                                    format = "%m/%d/%y"),
                                   str_detect(string = Date_Received,
                                              pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Received,
                                                                                                        format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2017 <-
  DOE_foia_log_2017 %>% 
  mutate(Date_Received = as.Date(Date_Received))

DOE_foia_log_2018 <-
  DOE_foia_log_2018 %>% 
  mutate(Date_Received = as.Date(Date_Received))

DOE_foia_log_2019 <-
  DOE_foia_log_2019 %>% 
  mutate(Date_Received = as.Date(Date_Received))

```

## Date_Response

```{r}

DOE_foia_log_2014 <-
  DOE_foia_log_2014 %>% 
  mutate(Date_Response = if_else(str_detect(string = Date_Response,
                                            pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 str_extract(string = Date_Response,
                                             pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 Date_Response),
         Date_Response = case_when(str_detect(string = Date_Response,
                                              pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Response),
                                                                              origin = "1899-12-30"),
                                   str_detect(string = Date_Response,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Response,
                                                                                                    format = "%m/%d/%Y"),
                                   str_detect(string = Date_Response,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Response,
                                                                                                    format = "%m/%d/%y"),
                                   str_detect(string = Date_Response,
                                              pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Response,
                                                                                                        format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2015 <-
  DOE_foia_log_2015 %>% 
  mutate(Date_Response = if_else(str_detect(string = Date_Response,
                                            pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 str_extract(string = Date_Response,
                                             pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                 Date_Response),
         Date_Response = case_when(str_detect(string = Date_Response,
                                              pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Response),
                                                                              origin = "1899-12-30"),
                                   str_detect(string = Date_Response,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Response,
                                                                                                    format = "%m/%d/%Y"),
                                   str_detect(string = Date_Response,
                                              pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Response,
                                                                                                    format = "%m/%d/%y"),
                                   str_detect(string = Date_Response,
                                              pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Response,
                                                                                                        format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2016 <-
  DOE_foia_log_2016 %>% 
  mutate(Date_Response = as.Date(Date_Response))

DOE_foia_log_2017 <-
  DOE_foia_log_2017 %>% 
  mutate(Date_Response = as.Date(Date_Response))

DOE_foia_log_2018 <-
  DOE_foia_log_2018 %>% 
  mutate(Date_Response = as.Date(Date_Response))

DOE_foia_log_2019 <-
  DOE_foia_log_2019 %>% 
  mutate(Date_Response = as.Date(Date_Response))

```

## Date_of_Final_Disposition

```{r}

DOE_foia_log_2014 <-
  DOE_foia_log_2014 %>% 
  mutate(Date_of_Final_Disposition = if_else(str_detect(string = Date_of_Final_Disposition,
                                                        pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                             str_extract(string = Date_of_Final_Disposition,
                                                         pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                             Date_of_Final_Disposition),
         Date_of_Final_Disposition = case_when(str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_of_Final_Disposition),
                                                                                          origin = "1899-12-30"),
                                               str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_of_Final_Disposition,
                                                                                                                format = "%m/%d/%Y"),
                                               str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_of_Final_Disposition,
                                                                                                                format = "%m/%d/%y"),
                                               str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_of_Final_Disposition,
                                                                                                                    format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2015 <-
  DOE_foia_log_2015 %>% 
  mutate(Date_of_Final_Disposition = if_else(str_detect(string = Date_of_Final_Disposition,
                                                        pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                             str_extract(string = Date_of_Final_Disposition,
                                                         pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                             Date_of_Final_Disposition),
         Date_of_Final_Disposition = case_when(str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_of_Final_Disposition),
                                                                                          origin = "1899-12-30"),
                                               str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_of_Final_Disposition,
                                                                                                                format = "%m/%d/%Y"),
                                               str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_of_Final_Disposition,
                                                                                                                format = "%m/%d/%y"),
                                               str_detect(string = Date_of_Final_Disposition,
                                                          pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_of_Final_Disposition,
                                                                                                                    format = "%m.%d.%y")))

```

```{r}

DOE_foia_log_2016 <-
  DOE_foia_log_2016 %>% 
  mutate(Date_of_Final_Disposition = as.Date(as.numeric(Date_of_Final_Disposition),
                                             origin = "1899-12-30"))

DOE_foia_log_2017 <-
  DOE_foia_log_2017 %>% 
  mutate(Date_of_Final_Disposition = as.Date(as.numeric(Date_of_Final_Disposition),
                                             origin = "1899-12-30"))

DOE_foia_log_2018 <-
  DOE_foia_log_2018 %>% 
  mutate(Date_of_Final_Disposition = as.Date(as.numeric(Date_of_Final_Disposition),
                                             origin = "1899-12-30"))

DOE_foia_log_2019 <-
  DOE_foia_log_2019 %>% 
  mutate(Date_of_Final_Disposition = as.Date(Date_of_Final_Disposition))

```

## Date_Agency_Response

```{r}

DOE_foia_log_2014$Date_Agency_Response
DOE_foia_log_2015$Date_Agency_Response
DOE_foia_log_2016$Date_Agency_Response
DOE_foia_log_2017$Date_Agency_Response
DOE_foia_log_2018$Date_Agency_Response
DOE_foia_log_2019$Date_Agency_Response

```

```{r}

DOE_foia_log_2014 <-
  mutate(Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        Date_Agency_Response),
         Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2} "),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}"),
                                        Date_Agency_Response),
         Date_Agency_Response = case_when(str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Agency_Response),
                                                                                     origin = "1899-12-30"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%Y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                               format = "%m.%d.%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}") ~ as.Date(paste0(Date_Agency_Response,"/14"),
                                                                                                       format = "%m/%d/%y")))

```

```{r}

DOE_foia_log_2015 <-
  DOE_foia_log_2015 %>% 
  mutate(Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        Date_Agency_Response),
         Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2} "),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}"),
                                        Date_Agency_Response),
         Date_Agency_Response = case_when(str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Agency_Response),
                                                                                     origin = "1899-12-30"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%Y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                               format = "%m.%d.%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}") ~ as.Date(paste0(Date_Agency_Response,"/15"),
                                                                                                       format = "%m/%d/%y")))

```

```{r}

DOE_foia_log_2016 <-
  DOE_foia_log_2016 %>% 
  mutate(Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        Date_Agency_Response),
         Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2} "),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}"),
                                        Date_Agency_Response),
         Date_Agency_Response = case_when(str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Agency_Response),
                                                                                     origin = "1899-12-30"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%Y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                               format = "%m.%d.%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}") ~ as.Date(paste0(Date_Agency_Response,"/16"),
                                                                                                       format = "%m/%d/%y")))

```

```{r}

DOE_foia_log_2017 <-
  DOE_foia_log_2017 %>% 
  mutate(Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        Date_Agency_Response),
         Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2} "),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}"),
                                        Date_Agency_Response),
         Date_Agency_Response = case_when(str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Agency_Response),
                                                                                     origin = "1899-12-30"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%Y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                               format = "%m.%d.%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}") ~ as.Date(paste0(Date_Agency_Response,"/17"),
                                                                                                       format = "%m/%d/%y")))

```

```{r}

DOE_foia_log_2018 <-
  DOE_foia_log_2018 %>% 
  mutate(Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}[/\\.][0-9]{2,4}"),
                                        Date_Agency_Response),
         Date_Agency_Response = if_else(str_detect(string = Date_Agency_Response,
                                                   pattern = "[0-9]{1,2}[/\\.][0-9]{1,2} "),
                                        str_extract(string = Date_Agency_Response,
                                                    pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}"),
                                        Date_Agency_Response),
         Date_Agency_Response = case_when(str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{5}") ~ as.Date(as.numeric(Date_Agency_Response),
                                                                                     origin = "1899-12-30"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{4}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%Y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}/[0-9]{1,2}/[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                           format = "%m/%d/%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]{2}") ~ as.Date(Date_Agency_Response,
                                                                                                               format = "%m.%d.%y"),
                                          str_detect(string = Date_Agency_Response,
                                                     pattern = "[0-9]{1,2}[/\\.][0-9]{1,2}") ~ as.Date(paste0(Date_Agency_Response,"/18"),
                                                                                                       format = "%m/%d/%y")))

```

```{r}

DOE_foia_log_2019 <-
  DOE_foia_log_2019 %>% 
  mutate(Date_Agency_Response = as.Date(Date_Agency_Response))

```


```{r}

DOE_foia_log_2014 %>% 
  union(DOE_foia_log_2015) %>% 
  union(DOE_foia_log_2016) %>% 
  union(DOE_foia_log_2017) %>% 
  union(DOE_foia_log_2018) %>% 
  union(DOE_foia_log_2019)

```

